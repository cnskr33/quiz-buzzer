<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Quizshow ‚Äì Zeitstrahl</title>

<!-- FIREBASE -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCob25y3pT7O6wjf21l9xiaCXhGMFLzFQg",
  authDomain: "testprojekt-dada3.firebaseapp.com",
  databaseURL: "https://testprojekt-dada3-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "testprojekt-dada3",
  storageBucket: "testprojekt-dada3.firebasestorage.app",
  messagingSenderId: "651866459764",
  appId: "1:651866459764:web:ed23cf3fd5ccf02a42cb21"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
</script>

<style>
body{margin:0;font-family:Arial;background:#0b1020;color:#e9eefc}

/* BUZZER */
.buzzerBar{
  background:#111a33;
  padding:12px;
  display:flex;
  gap:15px;
  align-items:center;
  justify-content:center;
  border-bottom:2px solid #2a3a66;
  flex-wrap:wrap;
}

.buzzerBtn{
  background:red;
  color:white;
  font-size:20px;
  padding:10px 20px;
  border:none;
  border-radius:10px;
  cursor:pointer;
}

.resetBtn{
  background:#333;
  color:white;
  border:none;
  padding:10px 15px;
  border-radius:10px;
  cursor:pointer;
}

.winner{
  font-weight:bold;
  font-size:18px;
}

/* SPIEL */
.app{
  padding:20px;
}

.timeline{
  display:grid;
  grid-template-columns: repeat(15, 1fr);
  gap:8px;
  margin-bottom:30px;
}

.slot{
  min-height:140px;
  border:2px dashed rgba(255,255,255,0.3);
  border-radius:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:4px;
}

.pool{
  display:grid;
  grid-template-columns: repeat(5, 1fr);
  gap:12px;
}

.cardItem{
  background: rgba(0,0,0,0.4);
  border-radius:12px;
  padding:8px;
  text-align:center;
  cursor:pointer;
  transition:0.2s;
}

.cardItem img{
  width:70px;
  height:70px;
  object-fit:cover;
  border-radius:8px;
  display:block;
  margin:auto;
  margin-bottom:6px;
}

.cardItem:hover{
  transform:scale(1.05);
}

.selected{
  outline:3px solid yellow;
}

.fixed{
  outline:3px solid lime;
}
</style>
</head>

<body>

<!-- BUZZER -->
<div class="buzzerBar">
  <button class="buzzerBtn" onclick="buzz()">üî¥ BUZZER</button>
  <button class="resetBtn" onclick="resetBuzz()">Reset</button>
  <span id="winner" class="winner"></span>
</div>

<div class="app">

<h2>Top 15 Fu√üballer ‚Äì Marktwert Zeitstrahl</h2>
<p>Links = niedriger Marktwert ‚Üí Rechts = h√∂her</p>

<button onclick="verifyPlacement()" style="margin-bottom:20px;">√úberpr√ºfen</button>

<div id="timeline" class="timeline"></div>

<h3>Spieler</h3>
<div id="pool" class="pool"></div>

</div>

<script>

/* ========= NAME CHECK ========= */
const myName = localStorage.getItem("quiz_name");
if(!myName){
  alert("Kein Name gefunden.");
  window.location.href = "index.html";
}

/* ========= BUZZER ========= */
async function buzz(){
  const buzzerRef = db.ref("buzzer");
  const snap = await buzzerRef.get();
  if(!snap.exists() || !snap.val()){
    buzzerRef.set(myName);
  }
}

function resetBuzz(){
  db.ref("buzzer").set("");
}

db.ref("buzzer").on("value", (snap)=>{
  const val = snap.val();
  document.getElementById("winner").textContent =
    val ? ("Gewinner: " + val) : "";
});

/* ========= SPIELDATEN ========= */

const players = [
{ name:"Lamine Yamal", value:258.4, img:"assets/lamine_yamal.jpg" },
{ name:"Kylian Mbapp√©", value:192.1, img:"assets/kylian_mbappe.jpg" },
{ name:"Vinicius Junior", value:182.7, img:"assets/vinicius_junior.jpg" },
{ name:"Erling Haaland", value:177.9, img:"assets/erling_haaland.jpg" },
{ name:"Jude Bellingham", value:177.1, img:"assets/jude_bellingham.jpg" },
{ name:"Michael Olise", value:156.7, img:"assets/michael_olise.jpg" },
{ name:"Pedri", value:142.3, img:"assets/pedri.jpg" },
{ name:"Cole Palmer", value:138.7, img:"assets/cole_palmer.jpg" },
{ name:"Jamal Musiala", value:130.7, img:"assets/jamal_musiala.jpg" },
{ name:"Jo√£o Neves", value:129.7, img:"assets/joao_neves.jpg" },
{ name:"Florian Wirtz", value:126.5, img:"assets/florian_wirtz.jpg" },
{ name:"Bukayo Saka", value:123.0, img:"assets/bukayo_saka.jpg" },
{ name:"Pau Cubars√≠", value:122.9, img:"assets/pau_cubarsi.jpg" },
{ name:"Declan Rice", value:121.1, img:"assets/declan_rice.jpg" },
{ name:"Viktor Gy√∂keres", value:120.1, img:"assets/viktor_gyokeres.jpg" }
];

let selectedCard = null;
let lastPlaced = null;

const pool = document.getElementById("pool");
const timeline = document.getElementById("timeline");

const SLOT_COUNT = 15;
const slots = [];

/* ========= ZEITSTRAHL MIT SHIFT ========= */

for(let i=0;i<SLOT_COUNT;i++){
  const slot = document.createElement("div");
  slot.className = "slot";
  slot.dataset.index = i;

  slot.onclick = () => {
    if(!selectedCard) return;

    const idx = parseInt(slot.dataset.index);
    placeWithShift(idx, selectedCard);

    lastPlaced = selectedCard;
    selectedCard.classList.remove("selected");
    selectedCard = null;
  };

  timeline.appendChild(slot);
  slots.push(slot);
}

function placeWithShift(targetIndex, card){

  removeIfExists(card);

  if(slots[targetIndex].children.length === 0){
    slots[targetIndex].appendChild(card);
    return;
  }

  let emptyRight = -1;
  for(let i=targetIndex;i<SLOT_COUNT;i++){
    if(slots[i].children.length === 0){
      emptyRight = i;
      break;
    }
  }

  if(emptyRight !== -1){
    for(let i=emptyRight;i>targetIndex;i--){
      if(slots[i-1].children.length > 0){
        slots[i].appendChild(slots[i-1].children[0]);
      }
    }
    slots[targetIndex].appendChild(card);
    return;
  }

  let emptyLeft = -1;
  for(let i=targetIndex;i>=0;i--){
    if(slots[i].children.length === 0){
      emptyLeft = i;
      break;
    }
  }

  if(emptyLeft !== -1){
    for(let i=emptyLeft;i<targetIndex;i++){
      if(slots[i+1].children.length > 0){
        slots[i].appendChild(slots[i+1].children[0]);
      }
    }
    slots[targetIndex].appendChild(card);
  }
}

function removeIfExists(card){
  for(const s of slots){
    if(s.children.length > 0 && s.children[0] === card){
      s.innerHTML = "";
    }
  }
}

/* ========= KARTEN ========= */

players.forEach(p => {

  const div = document.createElement("div");
  div.className = "cardItem";
  div.dataset.value = p.value;

  div.innerHTML = `
    <img src="${p.img}">
    <div>${p.name}</div>
  `;

  div.onclick = () => {
    if(div.classList.contains("fixed")) return;

    if(selectedCard){
      selectedCard.classList.remove("selected");
    }
    selectedCard = div;
    div.classList.add("selected");
  };

  pool.appendChild(div);
});

/* ========= √úBERPR√úFUNG ========= */

function verifyPlacement(){

  if(!lastPlaced) return;

  let placements = [];

  slots.forEach((slot, index)=>{
    if(slot.children.length > 0){
      const card = slot.children[0];
      placements.push({
        index:index,
        value:parseFloat(card.dataset.value),
        element:card
      });
    }
  });

  for(let i=0;i<placements.length;i++){
    for(let j=i+1;j<placements.length;j++){

      const a = placements[i];
      const b = placements[j];

      if(a.value < b.value && a.index > b.index){
        return sendBack(lastPlaced);
      }

      if(a.value > b.value && a.index < b.index){
        return sendBack(lastPlaced);
      }
    }
  }

  lastPlaced.classList.add("fixed");
  lastPlaced = null;
}

function sendBack(card){
  card.style.outline = "3px solid red";
  setTimeout(()=>{
    card.style.outline = "";
    pool.appendChild(card);
  },800);
  lastPlaced = null;
}

</script>

</body>
</html>
