<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Quizshow – Spiel</title>

<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyCob25y3pT7O6wjf21l9xiaCXhGMFLzFQg",
  authDomain: "testprojekt-dada3.firebaseapp.com",
  databaseURL: "https://testprojekt-dada3-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "testprojekt-dada3",
  storageBucket: "testprojekt-dada3.appspot.com",
  messagingSenderId: "651866459764",
  appId: "1:651866459764:web:ed23cf3fd5ccf02a42cb21"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

const params = new URLSearchParams(window.location.search);
const playerId = params.get("id");
if(!playerId){
  document.body.innerHTML = "<h2>Kein Name übergeben. Bitte über index.html einwählen</h2>";
  throw new Error("Kein Spieler");
}
const playerRef = db.ref("players/"+playerId);
playerRef.onDisconnect().remove();
</script>

<style>
body{margin:0;background:#0b1020;color:#e9eefc;font-family:Arial}
.app{padding:20px}
.timeline{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:20px}
.slot{border:2px dashed #555;min-width:140px;min-height:180px;padding:10px;text-align:center}
.card{background:#1c2545;border-radius:8px;padding:10px;cursor:grab}
.card img{width:90px;height:90px;object-fit:cover;border-radius:6px}
.pool{display:flex;gap:10px;flex-wrap:wrap}
.btn{background:#2563eb;color:white;border:none;padding:8px 12px;border-radius:6px;margin:5px;cursor:pointer}
.playerBox{background:#1c2545;padding:8px;margin:5px;border-radius:6px}
.hearts{font-size:18px}
</style>
</head>

<body>
<div class="app">

<h2 id="roundTitle"></h2>
<button class="btn" onclick="randomStart()">Zufällig</button>
<button class="btn" onclick="checkOrder()">Überprüfen</button>
<button class="btn" onclick="nextRound()">Nächste Runde</button>

<hr>
<h3>Zeitstrahl</h3>
<div id="timeline" class="timeline"></div>

<h3>Pool</h3>
<div id="pool" class="pool"></div>

<hr>
<h3>Spieler</h3>
<div id="players"></div>

</div>

<script>

/* ================= RUNDEN ================= */

const rounds = [

{
title:"Runde 1 – Marktwerte Fußball (Mio €)",
items:[
{ id:"yamal", name:"Lamine Yamal", value:258.4, img:"assets/lamine_yamal.jpg"},
{ id:"mbappe", name:"Kylian Mbappé", value:192.1, img:"assets/kylian_mbappe.jpg"},
{ id:"vinicius", name:"Vinicius Junior", value:182.7, img:"assets/vinicius_junior.jpg"},
{ id:"haaland", name:"Erling Haaland", value:177.9, img:"assets/erling_haaland.jpg"},
{ id:"bellingham", name:"Jude Bellingham", value:177.1, img:"assets/jude_bellingham.jpg"},
{ id:"olise", name:"Michael Olise", value:156.7, img:"assets/michael_olise.jpg"},
{ id:"pedri", name:"Pedri", value:142.3, img:"assets/pedri.jpg"},
{ id:"palmer", name:"Cole Palmer", value:138.7, img:"assets/cole_palmer.jpg"},
{ id:"musiala", name:"Jamal Musiala", value:130.7, img:"assets/jamal_musiala.jpg"},
{ id:"wirtz", name:"Florian Wirtz", value:126.5, img:"assets/florian_wirtz.jpg"},
{ id:"saka", name:"Bukayo Saka", value:123.0, img:"assets/bukayo_saka.jpg"},
{ id:"cubarsi", name:"Pau Cubarsí", value:122.9, img:"assets/pau_cubarsi.jpg"},
{ id:"rice", name:"Declan Rice", value:121.1, img:"assets/declan_rice.jpg"},
{ id:"gyokeres", name:"Viktor Gyökeres", value:120.1, img:"assets/viktor_gyokeres.jpg"},
{ id:"joaoneves", name:"João Neves", value:129.7, img:"assets/joao_neves.jpg"}
]
},

{
title:"Runde 2 – Kino Umsätze (Mrd $)",
items:[
{ id:"avatar", name:"Avatar", value:2.9238, img:"assets/avatar.jpg"},
{ id:"endgame", name:"Avengers Endgame", value:2.7994, img:"assets/avengers_endgame.jpg"},
{ id:"titanic", name:"Titanic", value:2.2772, img:"assets/titanic.jpg"},
{ id:"allesstehtkopf", name:"Alles steht Kopf 2", value:1.6989, img:"assets/alles_steht_kopf_2.jpg"},
{ id:"harry", name:"Harry Potter 7.2", value:1.3425, img:"assets/harry_potter.jpg"},
{ id:"mario", name:"Super Mario Bros", value:1.3626, img:"assets/super_mario_bros.jpg"},
{ id:"lion", name:"König der Löwen", value:1.6630, img:"assets/koenig_der_loewen.jpg"},
{ id:"starwars", name:"Star Wars 7", value:2.0713, img:"assets/star_wars.jpg"},
{ id:"frozen", name:"Die Eiskönigin", value:1.2864, img:"assets/eiskoenigin.jpg"},
{ id:"minions", name:"Minions", value:1.1675, img:"assets/minions.jpg"},
{ id:"darkknight", name:"Dark Knight Rises", value:1.0852, img:"assets/dark_knight.jpg"},
{ id:"dorie", name:"Findet Dorie", value:1.0293, img:"assets/findet_dorie.jpg"},
{ id:"oppenheimer", name:"Oppenheimer", value:0.9762, img:"assets/oppenheimer.jpg"},
{ id:"inception", name:"Inception", value:0.8499, img:"assets/inception.jpg"},
{ id:"fast7", name:"Fast & Furious 7", value:1.5198, img:"assets/fast_furious.jpg"}
]
}

];

let currentRound=0;
let placements=[];
let pool=[];

/* ================= SPIEL LOGIK ================= */

function initRound(){
const r=rounds[currentRound];
document.getElementById("roundTitle").innerText=r.title;
placements=[];
pool=[...r.items];
shuffle(pool);
randomStart();
}

function randomStart(){
pool=[...rounds[currentRound].items];
shuffle(pool);
placements=[pool.pop()];
render();
}

function render(){
const timeline=document.getElementById("timeline");
timeline.innerHTML="";
placements.forEach((item,i)=>{
const slot=document.createElement("div");
slot.className="slot";
slot.innerHTML=`<div class="card" draggable="true">
<img src="${item.img}">
<div>${item.name}</div></div>`;
slot.ondragover=e=>e.preventDefault();
slot.ondrop=e=>{
e.preventDefault();
const id=e.dataTransfer.getData("id");
const item=pool.find(x=>x.id===id);
if(!item)return;
pool=pool.filter(x=>x.id!==id);
placements.splice(i,0,item);
render();
};
timeline.appendChild(slot);
});

const poolDiv=document.getElementById("pool");
poolDiv.innerHTML="";
pool.forEach(item=>{
const card=document.createElement("div");
card.className="card";
card.draggable=true;
card.ondragstart=e=>e.dataTransfer.setData("id",item.id);
card.innerHTML=`<img src="${item.img}"><div>${item.name}</div>`;
poolDiv.appendChild(card);
});
}

function checkOrder(){
const correct=[...placements].sort((a,b)=>a.value-b.value);
for(let i=0;i<placements.length;i++){
if(placements[i].id!==correct[i].id){
const wrong=placements[i];
placements.splice(i,1);
pool.push(wrong);
loseLife();
render();
return;
}
}
alert("Richtig!");
}

function loseLife(){
playerRef.transaction(data=>{
if(!data)return data;
data.lives=(data.lives||2)-1;
if(data.lives<=0) data.lives=0;
return data;
});
}

function nextRound(){
currentRound++;
if(currentRound>=rounds.length) currentRound=0;
initRound();
}

function shuffle(arr){
for(let i=arr.length-1;i>0;i--){
const j=Math.floor(Math.random()*(i+1));
[arr[i],arr[j]]=[arr[j],arr[i]];
}
}

/* ================= SPIELER ================= */

db.ref("players").on("value",snap=>{
const container=document.getElementById("players");
container.innerHTML="";
snap.forEach(child=>{
const data=child.val();
const div=document.createElement("div");
div.className="playerBox";
div.innerHTML=`<strong>${data.name}</strong>
<div class="hearts">${"❤️".repeat(data.lives||2)}</div>`;
container.appendChild(div);
});
});

/* START */
initRound();
</script>
</body>
</html>
